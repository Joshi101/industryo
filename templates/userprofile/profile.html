{% extends "base.html" %}

{% load staticfiles %}
{% load bootstrap %}

{% block left %}
<div class="">
	<div id="img_profile_box">
	  
		<img id="img_profile" class="thumbnail" width="120" height="120" src="{{ user.userprofile.get_profile_image}}"/>
			
		<a id='img_upload' class="text-center" data-toggle='modal' data-target='#img_upload_modal' href="#">Change Image</a>
	</div>
	<div class="account">
		<h4 class="acc_detail">{{ name }}</h4>
		<h4 class="acc_detail"><small class='small_mid'>( {{ user.userprofile.job_position }} )</small></h4>
		<h4 class="acc_detail"><a href="#" class="no_a">{{ user.userprofile.primary_workplace }}</a></h4>
		<h5 class="acc_detail text-muted">{{user.userprofile.area}}</h5>
	</div>
</div>
<div id="img_upload_modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Change your profile picture <small>(it won't be cropped)</small></h4>
      </div>
      <div class="modal-body">
        <form action="{% url 'nodes:set_profile_image' %}" role='form' method="post" enctype="multipart/form-data">
        	{% csrf_token %}
		      <div class="image-editor center-block">
		      	<span class='btn btn-default btn-file center-block'>
		        	Browse {{profile_image_form.image}}
	        	</span>
		        <div class="cropit-image-preview"></div>
		        <div class="image-size-label text-center">
		          Resize image
		        </div>
		        <input type="range" class="cropit-image-zoom-input">
		        <div class="row">
		        	<button type="submit" class="btn btn-info col-sm-10 col-sm-offset-1">Submit</button>
	        	</div>
		      </div>
		    </form>
		    <input type="hidden" name="image-data" class="hidden-image-data" />
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
{% endblock left %}

{% block content %}
  <ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#about">About</a></li>
    <li><a data-toggle="tab" href="#questions">Questions</a></li>
    <li><a data-toggle="tab" href="#answers">Answers</a></li>
    <li><a data-toggle="tab" href="#articles">Articles</a></li>
    <li><a data-toggle="tab" href="#feeds">Feeds</a></li>
  </ul>

  <div class="tab-content">
    <div id="about" class="tab-pane fade in active">
      <div class="panel panel-default ajax_andar ajax_papa">
				<div class="panel-heading">
					<h3 class="text-muted detail_head">
						Experience
						{% ifequal user request.user %}
						<form id="experience" class="pull-right" action="{% url 'user:set_experience' %}" method="POST">
							<button data-content="experience" data-save='' class="btn btn-default btn-xs detail_edit pull-right" name="">Edit</button>
						</form>
						{% endifequal %}
					</h3>
				</div>
				<div class="panel-body">
					<div class="detail_body content_experience">{{user.userprofile.experience}}</div>
					<textarea name="experience" form="experience" rows="3" class="form-control edit_experience hide"></textarea>
					</form>
				</div>
			</div>
<<<<<<< HEAD
			<div class="panel panel-default ajax_andar ajax_papa">
				<div class="panel-heading">
					<h3 class="text-muted detail_head">
						Interests
						{% ifequal user request.user %}
						<button data-content="interest" data-save='' class="btn btn-default btn-xs detail_add pull-right" name="">Add</button>
						{% endifequal %}
					</h3>
					<form class="edit_interest hide" action="{% url 'user:set_interests' %}" method="POST" role="form">
		      	{% csrf_token %}
						<div class="d_search instant" data-results="instant">
							<input class="form-control d_input" data-search="tag" data-create="create" data-results="multiple" placeholder="Search for your interests here ...">
							<input type="hidden" name="interest" class="instant_i">
							<button type="submit" class="form-ajax hide"></button>
							<div class="dropdown">
								<ul class="dropdown-menu d_list">
								</ul>
							</div>
							<div class="d_results"></div>
						</div>
					</form>
				</div>
				<div class="panel-body">
					<div class="detail_body">
						{% for interest in user.userprofile.get_interests %}
							{% include 'snippets/one_interest.html' with interest=interest %}
						{% endfor %}
					</div>
				</div>
			</div>
    </div>
    <div id="questions" class="tab-pane fade">
  		{% for question in questions %}
				{% include 'forum/one_question.html' with node=node %}
			{% endfor %}    
    </div>
    <div id="answers" class="tab-pane fade">
    </div>
    <div id="articles" class="tab-pane fade">
    </div>
    <div id="feeds" class="tab-pane fade">
    	{% for node in feeds %}
				{% include 'nodes/one_node.html' with node=node %}
			{% endfor %}
    </div>
  </div>

	<script type="text/javascript">
	$('.detail').on({
		'mouseover':function(){
			$(this).children('.detail_opt').removeClass('hide');
		},
		'mouseout':function(){
			$(this).children('.detail_opt').addClass('hide');
		}
	});

	$('.detail_add').on('click',function(event){
		event.preventDefault();
		var $this = $(this)
		var save = $this.data('save');
		var	content = $this.data('content');
		var $forms = $('.edit_' + content);
		if (save == 'save'){
			$this.text('Add').data('save','');
			$forms.each(function(){
				$(this).addClass('hide');
			});
		}
		else {
			$this.text('Done').data('save','save');
			$forms.each(function(){
				$(this).removeClass('hide');
			});
		}
	});

	$('.detail_edit').on('click',function(event){
		event.preventDefault();
		var $this = $(this)
		var content = $this.data('content');
		var $content = $('.content_' + content);
		var save = $this.data('save');
		if (save == 'save'){
			console.log($('#experience').serialize())
			$content.each(function(){
				var value = $(this).next().val();
				$(this).text(value).removeClass('hide')
					.next().addClass('hide');
			});
			$this.text('Edit').data('save','').removeClass('form-ajax');
		}
		else {
			$content.each(function(){
				var value = $(this).text();
				$(this).addClass('hide')
					.next().val(value).removeClass('hide');
			});
			$this.text('Save').data('save','save').addClass('form-ajax');
		}
	});
	</script>
{% endblock %}