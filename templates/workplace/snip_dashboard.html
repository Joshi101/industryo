{% load filter %}
{% if user.userprofile in members %}
<div class="row">
	<div class="col-sm-8">
		<form class="single_form">
			<div id="random_card" class="dash_card bg_blue">
				<header><h3><span>Add Some Data</span></h3></header>
				<div class="dash_row">
					<div class="form-group">
						<input name="email" value="" placeholder="Emter Your email to recieve newsletters">
					</div>
				</div>
			</div>
		</form>
	</div>
	<div class="col-sm-4">
		<div class="dash_card">
			<div class="hover_a_container">
				<div class="dash_col blue text-center">
					<span class="fa fa-plus fa-4x" style="margin-top: 10px;"></span>
					<div><strong>Post Your Buying Requirements</strong></div>
				</div>
				<a class="hovering_a" style="margin: -10px" href="{% url 'leads:edit_add' 'new' %}"></a>
			</div>
		</div>
		<!-- <div class="dash_card">
			<div class="hover_a_container">
				<div class="dash_row">
					<h3><span class="num">{{inquiry_count}}</span>&nbsp;<span>Inquiries</span></h3>
				</div>
				<div class="dash_row">
					<h3><span class="num green">{{new_inq_count}}</span>&nbsp;<span style="color: #197">New</span></h3>
				</div>
				<a href="{% url 'products:enquiry_all' %}" class="hovering_a" style="margin: -10px -10px -1px -10px"></a>
			</div>
			<div class="dash_row bottom">
				<h3><span class="num">{{workplace.hits}}</span>&nbsp;<span>Profile Hits</span></h3>
			</div>
		</div> -->
	</div>
</div>
<div class="row">
	<div class="col-sm-8">
		<div class="row">
			<div class="col-sm-12">
				<div class="dash_card">
					<div class="row">
						<div class="col-sm-9">
							<header><h3><span class="num">{{workplace.get_product_count}}</span>&nbsp;<span>Products Listed</span></h3></header>
							<div class="data">
								<div class="row">
									{% if workplace.get_product_count = 0 %}
									<div class="col-sm-12 text-center">
										<p style="font-size: 1.4em; color: orange; margin-bottom: 5px">List the Products you Manufacture or Sell or the Services you Provide</p>
										<div class="text-muted">If You are busy, ask the sales people to signup &amp; List Products</div>
									</div>
									{% elif workplace.get_product_count < 3 %}
									{% with products.0 as product %}
									<div class="col-sm-3">
										<img class="lazy_img p_img" src="/images/product.png" data-src="{{product.get_image_thumbnail}}">
										<div class="p_name">{{product|truncatechars:20}}</div>
									</div>
									{% endwith %}
									<div class="col-sm-9 text-center">
										<p style="font-size: 1.4em; color: orange">List more products/ Services &amp; Get Inquiries directly in Inbox</p>
									</div>
									{% else %}
									{% for product in products|slice:"3" %}
									<div class="col-sm-4 text-center">
										<img class="lazy_img p_img" src="/images/main/product.png" data-src="{{product.get_image_thumbnail}}">
										<div class="p_name">{{product|truncatechars:15}}</div>
									</div>
									{% endfor %}
									{% endif %}
								</div>
							</div>
						</div>
						<div class="col-sm-3 text-center">
							<div class="hover_a_container">
								<div class="dash_col last blue">
									<span class="fa fa-plus fa-4x" style="margin-top: 20px;"></span>
									<div><strong>Add More</strong></div>
								</div>
								<a class="hovering_a" style="margin: -10px -10px -10px -1px" href="{% url 'products:edit_add' 'new' %}"></a>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="dash_card">
					<div class="dash_row">
						<h3><span class="num">{{workplace.number_of_employees|default:'0'}}</span>&nbsp;<span>People in {{workplace}}</span></h3>
					</div>
					<div class="dash_row">
						<h3><span class="num green">{{workplace.get_count}}</span>&nbsp;<span style="color: #197">on Corelogs</span></h3>
					</div>
					<div class="hover_a_container">
						<div class="dash_row bottom">
							<h3 class="blue"><span class="fa fa-plus fa-2x"></span>&nbsp;&nbsp;<span>Invite More</span></h3>
						</div>
						<a class="hovering_a ajax_a" style="margin: -1px -10px -10px -10px" data-place="#wp_content" href="{% url 'workplace:members' workplace.slug %}"></a>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="dash_card">
					<div class="data text-center">
						<div class="dash_row">
							<h3><span class="num green">{{q_count|default:'0'}}</span>&nbsp;<span>Questions</span></h3>
						</div>
						<div class="dash_row">
							<h3><span class="num green">{{a_count|default:'0'}}</span>&nbsp;<span>Answers</span></h3>
						</div>
						<div class="hover_a_container">
							<div class="dash_row bottom">
								<h3 class="blue"><span class="fa fa-question-circle" style="position: relative; top: 1px;"></span>&nbsp;<span>Forum</span></h3>
							</div>
							<a href="/forum" class="hovering_a" style="margin: -1px -10px -10px -10px"></a>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="dash_card">
					<div class="data text-center">
						<div style="height: 80px; padding: 15px 0px;">
							<h3><span class="num green">{{node_count}}</span><br>
							<span style="padding: 5px">Updates</span></h3>
						</div>
						<div class="hover_a_container">
							<div class="dash_row bottom">
								<h3 class="blue"><span class="fa fa-rss" style="position: relative; top: 1px;"></span>&nbsp;<span>Feed</span></h3>
							</div>
							<a href="{% url 'home' %}" class="hovering_a" style="margin: -1px -10px -10px -10px"></a>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="dash_card">
					<div class="dash_sq">
						<h3><span class="num">{{workplace.get_tags.city|length}}</span>&nbsp;<span>Cities</span></h3>
					</div>
					<div class="dash_sq">
						<h3><span class="num">{{workplace.get_tags.operations|length}}</span>&nbsp;<span>Operations</span></h3>
					</div>
					<div class="dash_sq">
						<h3><span class="num">{{workplace.get_tags.assets|length}}</span>&nbsp;<span>Assets</span></h3>
					</div>
					<div class="dash_sq">
						<h3><span class="num">{{workplace.get_tags.segments|length}}</span>&nbsp;<span>Segments</span></h3>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-sm-4 tall_cards">
		<div class="dash_card">
			<header>
				<h3 style="margin-bottom: 0">Profile Completion Score</h3>
				<p class="text-muted text-center"><small>A High score helps your company appear up in searches</small></p>
			</header>
				<div class="data text-center">
					<div style="margin-bottom: 5px">
						<div class="chart circle_bar" data-percent="{{completion_score|floatformat:'0'}}"></div>
					</div>
					<p style="margin-bottom: 5px"><strong>Why?</strong></p>
					<div class="circle_bar_container">
						<div class="row">
							<div class="col-md-6 chartright">
								<a class="help_pop pull-left" data-toggle="popover" data-trigger="hover click" data-placement="top" data-title="Why only {{workplace.get_member_score}}%?" data-content="Multiple people from a company can be a part of your company on CoreLogs. Invite your colleagues to join."><span class="fa fa-fw fa-question-circle"></span></a>
								<span class="text">Members</span>
								<span class="chart small_chart circle_bar" data-size="40" data-line="2" data-percent="{{workplace.get_member_score}}"></span>
							</div>
							<div class="col-md-6 chartleft">
								<span class="chart small_chart circle_bar" data-size="40" data-line="2" data-percent="{{workplace.get_info_score}}"></span>
								<span class="text">Info</span>
								<a class="help_pop pull-right" data-toggle="popover" data-trigger="hover click" data-placement="top" data-title="What does it mean?" data-content="Fill all the data in the Edit form to increase score. High score means high credibility."><span class="fa fa-fw fa-question-circle"></span></a>
							</div>
						</div>
						<div class="row">
							<div class="col-md-6 chartright">
								<a class="help_pop pull-left" data-toggle="popover" data-trigger="hover click" data-placement="bottom" data-title="What it does?" data-content="More Products help you reach out to more Customers and get more Inquiries &amp; Orders"><span class="fa fa-fw fa-question-circle"></span></a>
								<span class="text">Products</span>
								<span class="chart small_chart circle_bar" data-size="40" data-line="2" data-percent="{{workplace.get_product_score}}"></span>
							</div>
							<div class="col-md-6 chartleft">
								<span class="chart small_chart circle_bar" data-size="40" data-line="2" data-percent="{{workplace.get_tags_score}}"></span>
								<span class="text">Tags</span>
								<a class="help_pop pull-right" data-toggle="popover" data-trigger="hover click" data-placement="right" data-title="What it does?" data-content="Appropriate Cities, Segment of market, Operation, Assets Help your SME to appear in searches."><span class="fa fa-fw fa-question-circle"></span></a>
							</div>
						</div>
					</div>
				</div>
		</div>
	</div>
</div>

{% endif %}
<script type="text/javascript">
	$('.circle_bar').each(function(index, el) {

		/*var el = document.getElementById('graph'); // get canvas*/

		var options = {
		    percent:  el.getAttribute('data-percent') || 25,
		    size: el.getAttribute('data-size') || 115,
		    lineWidth: el.getAttribute('data-line') || 15,
		    rotate: el.getAttribute('data-rotate') || 0
		}

		var canvas = document.createElement('canvas');
		var span = document.createElement('span');
		span.textContent = options.percent + '%';
		    
		if (typeof(G_vmlCanvasManager) !== 'undefined') {
		    G_vmlCanvasManager.initElement(canvas);
		}

		var ctx = canvas.getContext('2d');
		canvas.width = canvas.height = options.size;

		el.appendChild(span);
		el.appendChild(canvas);

		ctx.translate(options.size / 2, options.size / 2); // change center
		ctx.rotate((-1 / 2 + options.rotate / 180) * Math.PI); // rotate -90 deg

		//imd = ctx.getImageData(0, 0, 240, 240);
		var radius = (options.size - options.lineWidth) / 2;

		var drawCircle = function(color, lineWidth, percent) {
				percent = Math.min(Math.max(0, percent || 1), 1);
				ctx.beginPath();
				ctx.arc(0, 0, radius, 0, Math.PI * 2 * percent, false);
				ctx.strokeStyle = color;
		        ctx.lineCap = 'round'; // butt, round or square
				ctx.lineWidth = lineWidth
				ctx.stroke();
		};

		if (options.percent >= 75)
			var color = '#197';
		else if (options.percent >= 40)
			var color = '#fa0';
		else
			var color = '#a00';

		drawCircle('#efefef', options.lineWidth, 100 / 100);
		drawCircle(color, options.lineWidth, options.percent / 100);
	});
</script>
